name: Deploy Frontend to Vercel

on:
  workflow_run:
    workflows: ["Deploy Backend to Railway"]
    types: [completed]
  push:
    branches: [ main ]
    paths: 
      - 'frontend/**'
  workflow_dispatch:

jobs:
  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Wait for Backend if needed
        run: |
          if [ "${{ github.event_name }}" = "push" ]; then
            echo "â³ Code push detected - waiting for backend to be healthy first..."
            max_attempts=20
            attempt=0
            
            while [ $attempt -lt $max_attempts ]; do
              if curl -sf --max-time 10 https://naija-conflict-tracker-production.up.railway.app/health > /dev/null 2>&1; then
                echo "âœ… Backend is healthy!"
                break
              fi
              echo "Waiting for backend... $((attempt+1))/$max_attempts"
              sleep 10
              attempt=$((attempt+1))
            done
          else
            echo "Manual trigger or workflow_run - proceeding with deployment"
          fi
      
      - name: Deploy to Vercel
        run: |
          echo "ðŸš€ Deploying frontend to Vercel..."
          echo "Vercel auto-deploys from GitHub push"
          echo "Frontend will connect to: https://naija-conflict-tracker-production.up.railway.app"

      - name: Deployment Complete
        run: |
          echo "================================"
          echo "âœ… Deployment sequence complete!"
          echo "ðŸ”— Frontend: Check Vercel dashboard"
          echo "ðŸ”— Backend: https://naija-conflict-tracker-production.up.railway.app"
          echo "================================"
